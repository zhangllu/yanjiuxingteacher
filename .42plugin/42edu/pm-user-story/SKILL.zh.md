---
name: user-story
description: 本技能用于将产品需求拆解为可执行的用户故事。基于人类永恒的三个最小故事（光明、黑暗、灰色）来组织和评判故事质量，帮助创建故事集、编写用户故事、规划实现迭代。
depends:
  - real.md
  - cog.md
  - spec-product-requirements.md
generates:
  - spec-user-story.md
---

# 用户故事（基于三个最小故事）

## 概述

本技能将产品需求转化为可执行的用户故事。我们采用传统的用户故事格式，但用**人类永恒的三个最小故事**（光明、黑暗、灰色）作为组织和评判框架，确保故事既符合人性又易于实现。

> **核心理念**：所有复杂叙事都源于三个最小故事——光明（从坏到好）、黑暗（从好到坏）、灰色（循环往复）。好的用户故事应该让用户体验到这些永恒模式。

> **AI智能体注意**：本技能生成供AI/Agent（特别是Claude Code）使用的规约文档，确保故事实现具有清晰的用户价值和可测试性。

## 前置条件

使用本技能前，确保以下基础文档存在：

1. **real.md** - 现实约束文档
2. **cog.md** - 认知模型文档
3. **spec-product-requirements.md** - 产品需求文档

如果这些文件不存在，请先调用相应的技能创建它们。

### 执行前检查清单

```
[ ] real.md存在于项目根目录或.42cog目录
[ ] cog.md存在于项目根目录或.42cog目录
[ ] spec-product-requirements.md存在且包含核心需求
[ ] 已识别用户类型及其目标
[ ] 已理解产品的核心价值主张
```

### 上下文加载

从 **cog.md** 中提取：
- **用户类型**：不同的用户角色
- **用户目标**：每类用户想要达成什么
- **用户能力**：用户具备的技能和限制

从 **spec-product-requirements.md** 中提取：
- **核心功能**：产品提供的主要功能
- **功能优先级**：哪些功能最重要
- **用户价值**：每个功能为用户带来的价值

从 **real.md** 中提取：
- **边界条件**：用户故事的边界
- **安全约束**：必须遵守的安全规则
- **技术约束**：实现的技术限制

## 三个最小故事框架

### 故事原型

人类所有的叙事都可以归结为三个最小故事：

| 故事类型 | 模式 | 情感曲线 | 用户体验 | 产品应用 |
|---------|------|---------|---------|---------|
| **光明故事** | 从坏到好 | ↗️ 上升 | 问题解决、目标达成 | 注册→成功使用 |
| **黑暗故事** | 从好到坏 | ↘️ 下降 | 遇到困难、需要帮助 | 错误处理、异常提示 |
| **灰色故事** | 循环往复 | 🔄 波动 | 持续使用、习惯养成 | 日常操作、重复任务 |

### 在用户故事中的应用

**光明故事（成长型）**：
- 用户从"不能做X"到"能够做X"
- 从"困难"到"容易"
- 从"不懂"到"理解"
- 示例：新用户注册、首次成功操作、技能提升

**黑暗故事（挑战型）**：
- 用户遇到错误或障碍
- 系统帮助用户识别和解决问题
- 从"正常"到"异常"再到"恢复"
- 示例：表单验证失败、权限不足、数据丢失预警

**灰色故事（日常型）**：
- 用户的重复性操作
- 需要优化效率和体验
- 从"陌生"到"熟练"到"自动化"
- 示例：每日登录、常规查询、批量操作

## 故事层级

### 最小故事（Minimal Story, MS）

最小故事是**不可再分的用户价值单元**，一个迭代内可以完成。

**特征**：
- 独立完整的用户价值
- 1-3天可以实现
- 有明确的完成标准
- 用户可以立即感知到价值

**编号规则**：MS-[类型]-[序号]
- MS-L-01：光明故事1（Light）
- MS-D-01：黑暗故事1（Dark）
- MS-G-01：灰色故事1（Grey）

### 复杂故事（Complex Story, CS）

复杂故事是**多个最小故事的组合**，形成完整的用户旅程。

**特征**：
- 包含3-8个最小故事
- 跨越多个迭代
- 形成完整的功能模块
- 通常混合多种故事类型

**编号规则**：CS-[序号]
- CS-01：用户账户管理
- CS-02：内容创作流程

## 使用场景

- 将产品需求拆解为可执行的故事
- 为敏捷开发创建待办事项
- 为功能定义验收标准
- 规划实现迭代
- 向开发人员传达用户价值

## 流程

### 阶段一：识别复杂故事

从产品需求中提取主要的用户旅程，形成复杂故事。

**复杂故事模板：**

```markdown
## 复杂故事：[CS-XX] [故事名称]

**描述：** [这个故事涵盖的完整用户旅程]
**用户类型：** [主要用户角色]
**核心价值：** [为用户带来的主要价值]

**故事类型分布：**
- 光明故事：X个（用户成长）
- 黑暗故事：Y个（问题处理）
- 灰色故事：Z个（日常使用）

**包含的最小故事：**
- MS-L-01: 最小故事1
- MS-L-02: 最小故事2
- MS-D-01: 最小故事3
- MS-G-01: 最小故事4

**用户旅程：**
[起点] → [关键节点1] → [关键节点2] → [终点]
```

**标准复杂故事分类：**

| 复杂故事 | 描述 | 典型最小故事数 |
|---------|------|--------------|
| CS-01: 用户入门 | 注册、登录、首次使用 | 3-5个 |
| CS-02: 核心功能 | 产品的主要价值功能 | 5-8个 |
| CS-03: 用户配置 | 个性化设置 | 2-4个 |
| CS-04: 管理功能 | 管理员操作 | 3-6个 |

### 阶段二：编写最小故事

**最小故事格式：**

```markdown
## 最小故事：[MS-X-XX] [标题]

**复杂故事：** [CS-XX]
**故事类型：** 光明/黑暗/灰色
**优先级：** P0/P1/P2
**故事点数：** 1/2/3/5/8

### 用户故事
作为一个 [用户类型]，
我想要 [做什么]，
以便 [达成什么目标/获得什么价值]。

### 故事评判（基于三个最小故事）

**如果是光明故事（从坏到好）：**
- **起点状态**：用户当前的困境或限制
- **转折点**：系统提供的关键能力
- **终点状态**：用户达成的目标或获得的能力
- **情感体验**：从困惑/受限 → 理解/自由

**如果是黑暗故事（从好到坏）：**
- **起点状态**：用户的正常操作状态
- **转折点**：出现的问题或错误
- **终点状态**：系统帮助用户识别和恢复
- **情感体验**：从顺利 → 受阻 → 得到帮助

**如果是灰色故事（循环往复）：**
- **循环模式**：用户重复执行的操作
- **优化点**：如何让重复更高效
- **习惯养成**：如何从陌生到熟练
- **情感体验**：从费力 → 轻松 → 自动化

### 验收标准
- AC1: [可测试的标准1]
- AC2: [可测试的标准2]
- AC3: [可测试的标准3]

### 用户可感知的变化
- **操作前**：[用户看到/感受到什么]
- **操作中**：[用户执行什么动作]
- **操作后**：[用户看到/感受到什么变化]

### 约束（来自real.md）
- [约束1]
- [约束2]

### 依赖
- **需要**：[前置故事]
- **使能**：[后续故事]
```

**故事编写指南：**

| 元素 | 好的示例 | 不好的示例 |
|------|---------|-----------|
| 用户类型 | "新注册用户" | "用户" |
| 想要做什么 | "创建第一个项目" | "使用系统" |
| 达成目标 | "开始管理我的任务" | "能够工作" |
| 验收标准 | "项目创建成功且显示在列表中" | "功能正常" |

**INVEST原则（保持传统最佳实践）：**
- **I**ndependent（独立）：可以单独开发和测试
- **N**egotiable（可协商）：细节可以讨论调整
- **V**aluable（有价值）：为用户带来明确价值
- **E**stimable（可估算）：可以估算工作量
- **S**mall（小）：一个迭代内可完成
- **T**estable（可测试）：有清晰的验收标准

### 阶段三：定义验收标准

每个最小故事需要3-5条可测试的验收标准。

**验收标准格式：**

**格式1：场景式**
```markdown
### 验收标准

**场景1：正常流程**
- 给定：[前置条件]
- 当：[用户操作]
- 那么：[预期结果]

**场景2：异常处理**
- 给定：[异常条件]
- 当：[用户操作]
- 那么：[系统反应]
```

**格式2：清单式**
```markdown
### 验收标准

- [ ] 用户可以看到[界面元素]
- [ ] 用户点击[按钮]后，系统[执行动作]
- [ ] 系统显示[反馈信息]
- [ ] 数据保存到[存储位置]
- [ ] 用户可以[后续操作]
```

**标准质量检查：**
- [ ] 可以通过测试验证
- [ ] 用户可以直接感知
- [ ] 覆盖正常和异常情况
- [ ] 符合real.md中的约束
- [ ] 明确定义"完成"的标准

### 阶段四：创建故事地图

故事地图可视化用户旅程并确定故事优先级。

**故事地图结构：**

```
用户旅程：入门 → 使用 → 精通 → 传播

迭代1（MVP）:
├── CS-01: 用户入门
│   ├── MS-L-01: 快速注册（光明）
│   │   └── 从"无账户" → "有账户"
│   ├── MS-L-02: 首次登录（光明）
│   │   └── 从"门外" → "进入"
│   └── MS-D-01: 登录失败处理（黑暗）
│       └── 从"顺利" → "受阻" → "恢复"
├── CS-02: 核心功能
│   ├── MS-L-03: 创建第一个项目（光明）
│   └── MS-L-04: 完成第一个任务（光明）

迭代2:
├── CS-02: 核心功能（续）
│   ├── MS-G-01: 查看项目列表（灰色）
│   └── MS-G-02: 编辑任务（灰色）
├── CS-03: 用户配置
│   └── MS-L-05: 个性化设置（光明）

迭代3:
├── CS-04: 高级功能
└── CS-05: 协作功能
```

**按故事类型排优先级：**

| 优先级 | 故事类型组合 | 理由 | 决策 |
|--------|------------|------|------|
| P0 | 光明为主 | 用户需要快速看到价值 | 优先实现 |
| P1 | 光明+黑暗 | 基础功能+错误处理 | 迭代2 |
| P2 | 灰色为主 | 优化日常使用体验 | 后续优化 |

### 阶段五：实现规划

**实现计划模板：**

```markdown
## 迭代 [N] 计划

**目标：** [本迭代的核心目标]
**周期：** [2周]
**复杂故事：** [CS-XX, CS-YY]

### 最小故事列表

| 故事ID | 标题 | 类型 | 故事点数 | 负责人 |
|--------|------|------|---------|--------|
| MS-L-01 | 快速注册 | 光明 | 3 | 张三 |
| MS-L-02 | 首次登录 | 光明 | 2 | 李四 |
| MS-D-01 | 登录失败 | 黑暗 | 2 | 王五 |

### 故事类型分布
- 光明故事：5个（60%）- 主要价值交付
- 黑暗故事：2个（25%）- 错误处理
- 灰色故事：1个（15%）- 体验优化

### 用户价值预期
本迭代结束后，用户可以：
1. [完成的用户旅程1]
2. [完成的用户旅程2]
3. [完成的用户旅程3]

### 依赖
- **外部**：[API访问、设计资源]
- **内部**：[其他团队交付物]

### 风险
- 风险1：[描述]
  - 缓解：[应对措施]
```

## 输出模板

### 用户故事文档

```markdown
# 用户故事：[产品名称]

## 复杂故事概览

| 复杂故事 | 最小故事数 | 优先级 | 故事类型分布 |
|---------|-----------|--------|-------------|
| CS-01 | 5 | P0 | 光明3, 黑暗1, 灰色1 |
| CS-02 | 8 | P0 | 光明4, 黑暗2, 灰色2 |

## 按复杂故事分组

### CS-01: [名称]

#### MS-L-01: [标题]
[完整的最小故事，包含故事评判和验收标准]

#### MS-D-01: [标题]
[完整的最小故事，包含故事评判和验收标准]

## 故事地图

[可视化的用户旅程和迭代分解]

## 实现建议

[按迭代1、2、3分解的实现计划]

## 测试指南

[如何验证每个故事的完成标准]
```

## 质量检查清单

- [ ] 所有核心功能都有对应的最小故事
- [ ] 每个最小故事遵循INVEST原则
- [ ] 故事类型分布合理（光明为主，黑暗和灰色为辅）
- [ ] 验收标准清晰可测试
- [ ] 依赖关系已识别
- [ ] 故事规模适当（1-3天完成）
- [ ] 反映了real.md中的约束
- [ ] 故事地图显示清晰的用户旅程
- [ ] 每个故事都有明确的用户价值

## 与其他技能的关系

| 技能 | 关系 |
|------|------|
| product-requirements | 输入：需求转化为故事 |
| system-architecture | 输出：故事影响架构设计 |
| ui-design | 输出：故事驱动界面设计 |
| coding | 输出：故事成为开发任务 |
| quality-assurance | 输出：验收标准成为测试用例 |

---

## 附录：三个最小故事的深层理解

### 为什么是这三个故事？

认知科学研究表明，人类大脑天生对这三种模式敏感：

1. **光明故事（进步叙事）**
   - 激活大脑的奖励系统
   - 产生多巴胺，带来愉悦感
   - 用户最容易记住和传播
   - 产品示例：首次成功、技能提升、问题解决

2. **黑暗故事（危机叙事）**
   - 激活大脑的警觉系统
   - 产生注意力集中，促进学习
   - 帮助用户建立安全感
   - 产品示例：错误提示、风险预警、恢复机制

3. **灰色故事（循环叙事）**
   - 激活大脑的习惯系统
   - 产生自动化，降低认知负荷
   - 帮助用户形成使用习惯
   - 产品示例：日常操作、重复任务、批量处理

### 故事类型的黄金比例

根据用户体验研究，最佳的故事类型分布是：

| 产品阶段 | 光明 | 黑暗 | 灰色 |
|---------|------|------|------|
| MVP阶段 | 70% | 20% | 10% |
| 成长阶段 | 50% | 30% | 20% |
| 成熟阶段 | 40% | 20% | 40% |

**原因**：
- 早期需要快速展示价值（光明为主）
- 中期需要建立信任（增加黑暗故事）
- 后期需要优化效率（增加灰色故事）

### 可供性思维的简化应用

虽然我们不使用复杂的可供性术语，但核心思想保留：

| 可供性概念 | 简化表达 |
|-----------|---------|
| 可供性 | 用户可以做什么 |
| 感知通道 | 用户如何知道可以做 |
| 行动 | 用户执行的操作 |
| 反馈 | 用户看到的结果 |

**在验收标准中体现**：
```markdown
- [ ] 用户可以看到[按钮]（感知）
- [ ] 用户点击[按钮]后（行动）
- [ ] 系统显示[结果]（反馈）
```

---

**最后更新**：2025-12-06
**文档版本**：v3.1（基于三个最小故事）
**维护者**：42COG团队
