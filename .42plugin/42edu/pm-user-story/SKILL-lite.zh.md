---
name: user-story
description: 将产品需求拆解为用户故事，基于三个最小故事（光明/黑暗/灰色）组织
depends:
  - real.md
  - cog.md
  - pr.spec.md
generates:
  - userstory.spec.md
---

# 用户故事（三个最小故事）

## 前置条件

1. 读取 `real.md` 获取约束
2. 读取 `cog.md` 获取用户类型和目标
3. 读取 `pr.spec.md` 获取功能需求

## 三个最小故事

| 类型 | 模式 | 应用场景 | 编号 |
|------|------|----------|------|
| 光明 | 从坏到好 | 注册、首次成功、目标达成 | MS-L-XX |
| 黑暗 | 从好到坏 | 错误处理、异常恢复 | MS-D-XX |
| 灰色 | 循环往复 | 日常操作、重复任务 | MS-G-XX |

**黄金比例**：MVP 阶段 光明70% / 黑暗20% / 灰色10%

## 故事层级

- **复杂故事（CS）**：完整用户旅程，包含 3-8 个最小故事
- **最小故事（MS）**：不可再分的用户价值单元，1-3 天完成

## 流程

### 1. 识别复杂故事

从需求中提取用户旅程：
```
CS-01: 用户入门（注册→登录→首次使用）
CS-02: 核心功能（主要价值功能）
CS-03: 用户配置（个性化设置）
```

### 2. 编写最小故事

```markdown
### MS-L-XX：[标题]

**所属**：CS-XX | **类型**：光明/黑暗/灰色 | **优先级**：P0/P1/P2

**用户故事**：
作为 [用户类型]，我想要 [做什么]，以便 [获得什么价值]

**故事评判**：
- 起点：[当前状态]
- 转折：[系统提供的能力]
- 终点：[达成的目标]

**验收标准**：
- [ ] [可测试标准1]
- [ ] [可测试标准2]

**约束**：[来自 real.md]
**依赖**：需要 [前置] / 使能 [后续]
```

### 3. 创建故事地图

```
迭代1（MVP）:
├── CS-01: 用户入门
│   ├── MS-L-01: 注册（光明）
│   ├── MS-L-02: 登录（光明）
│   └── MS-D-01: 登录失败（黑暗）
└── CS-02: 核心功能
    └── MS-L-03: 核心操作（光明）

迭代2: ...
```

## 输出结构

```markdown
# 用户故事规格书

## 复杂故事概览
| CS | 名称 | MS数 | 优先级 | 类型分布 |

## CS-01: [名称]
### MS-L-01: [标题]
[完整最小故事]

## 故事地图
[迭代分解]

## 故事类型分布
| 迭代 | 光明 | 黑暗 | 灰色 |
```

## 质量检查

- [ ] 每个故事遵循 INVEST 原则
- [ ] 故事类型分布合理
- [ ] 验收标准可测试
- [ ] 反映 real.md 约束

---

**版本**：v4.0-lite
**更新**：2025-12-06
